(function () {
	'use strict';

	function w$1(){}function J$1(t){return t()}function K(){return Object.create(null)}function k(t){t.forEach(J$1);}function T(t){return typeof t=="function"}function rt$1(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function ct$1(t){return Object.keys(t).length===0}function ut$1(t,...e){if(t==null)return w$1;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function At(t,e,n){t.$$.on_destroy.push(ut$1(e,n));}function Ot(t){return t&&T(t.destroy)?t.destroy:w$1}function ft$1(t,e){t.appendChild(e);}function jt(t,e,n){t.insertBefore(e,n||null);}function ht$1(t){t.parentNode.removeChild(t);}function pt$1(t){return document.createElement(t)}function X$1(t){return document.createTextNode(t)}function Rt(){return X$1(" ")}function qt(){return X$1("")}function Bt(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function Dt(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n);}function mt(t){return Array.from(t.childNodes)}function Tt(t,e){e=""+e,t.wholeText!==e&&(t.data=e);}function Y(t,e,n=!1){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,!1,e),i}let z;function N(t){z=t;}function tt$1(){if(!z)throw new Error("Function called outside component initialization");return z}function Lt(t){tt$1().$$.on_mount.push(t);}function Wt(){const t=tt$1();return (e,n)=>{const i=t.$$.callbacks[e];if(i){const r=Y(e,n);i.slice().forEach(a=>{a.call(t,r);});}}}const C=[],et$1=[],R=[],nt$1=[],$t=Promise.resolve();let W=!1;function wt$1(){W||(W=!0,$t.then(st$1));}function q(t){R.push(t);}let G=!1;const H=new Set;function st$1(){if(!G){G=!0;do{for(let t=0;t<C.length;t+=1){const e=C[t];N(e),xt(e.$$);}for(N(null),C.length=0;et$1.length;)et$1.pop()();for(let t=0;t<R.length;t+=1){const e=R[t];H.has(e)||(H.add(e),e());}R.length=0;}while(C.length);for(;nt$1.length;)nt$1.pop()();W=!1,G=!1,H.clear();}}function xt(t){if(t.fragment!==null){t.update(),k(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(q);}}const B=new Set;let x$1;function Gt(){x$1={r:0,c:[],p:x$1};}function Ht(){x$1.r||k(x$1.c),x$1=x$1.p;}function ot$1(t,e){t&&t.i&&(B.delete(t),t.i(e));}function It(t,e,n,i){if(t&&t.o){if(B.has(t))return;B.add(t),x$1.c.push(()=>{B.delete(t),i&&(n&&t.d(1),i());}),t.o(e);}}function Kt(t,e){t.d(1),e.delete(t.key);}function Qt(t,e,n,i,r,a,s,l,f,o,p,d){let c=t.length,u=a.length,_=c;const g={};for(;_--;)g[t[_].key]=_;const m=[],y=new Map,v=new Map;for(_=u;_--;){const h=d(r,a,_),b=n(h);let $=s.get(b);$?i&&$.p(h,e):($=o(b,h),$.c()),y.set(b,m[_]=$),b in g&&v.set(b,Math.abs(_-g[b]));}const E=new Set,M=new Set;function D(h){ot$1(h,1),h.m(l,p),s.set(h.key,h),p=h.first,u--;}for(;c&&u;){const h=m[u-1],b=t[c-1],$=h.key,O=b.key;h===b?(p=h.first,c--,u--):y.has(O)?!s.has($)||E.has($)?D(h):M.has(O)?c--:v.get($)>v.get(O)?(M.add($),D(h)):(E.add(O),c--):(f(b,s),c--);}for(;c--;){const h=t[c];y.has(h.key)||f(h,s);}for(;u;)D(m[u-1]);return m}function Ut(t){t&&t.c();}function kt(t,e,n,i){const{fragment:r,on_mount:a,on_destroy:s,after_update:l}=t.$$;r&&r.m(e,n),i||q(()=>{const f=a.map(J$1).filter(T);s?s.push(...f):k(f),t.$$.on_mount=[];}),l.forEach(q);}function St(t,e){const n=t.$$;n.fragment!==null&&(k(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[]);}function Ft(t,e){t.$$.dirty[0]===-1&&(C.push(t),wt$1(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31;}function Vt(t,e,n,i,r,a,s,l=[-1]){const f=z;N(t);const o=t.$$={fragment:null,ctx:null,props:a,update:w$1,not_equal:r,bound:K(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(f?f.$$.context:[])),callbacks:K(),dirty:l,skip_bound:!1,root:e.target||f.$$.root};s&&s(o.root);let p=!1;if(o.ctx=n?n(t,e.props||{},(d,c,...u)=>{const _=u.length?u[0]:c;return o.ctx&&r(o.ctx[d],o.ctx[d]=_)&&(!o.skip_bound&&o.bound[d]&&o.bound[d](_),p&&Ft(t,d)),c}):[],o.update(),p=!0,k(o.before_update),o.fragment=i?i(o.ctx):!1,e.target){if(e.hydrate){const d=mt(e.target);o.fragment&&o.fragment.l(d),d.forEach(ht$1);}else o.fragment&&o.fragment.c();e.intro&&ot$1(t.$$.fragment),kt(t,e.target,e.anchor,e.customElement),st$1();}N(f);}class Xt{$destroy(){St(this,1),this.$destroy=w$1;}$on(e,n){const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1);}}$set(e){this.$$set&&!ct$1(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1);}}const F=[];function Yt(t,e=w$1){let n;const i=new Set;function r(l){if(rt$1(t,l)&&(t=l,n)){const f=!F.length;for(const o of i)o[1](),F.push(o,t);if(f){for(let o=0;o<F.length;o+=2)F[o][0](F[o+1]);F.length=0;}}}function a(l){r(l(t));}function s(l,f=w$1){const o=[l,f];return i.add(o),i.size===1&&(n=e(r)||w$1),l(t),()=>{i.delete(o),i.size===0&&(n(),n=null);}}return {set:r,update:a,subscribe:s}}

	var t$1;(function(s){s[s.All=0]="All",s[s.Debug=1]="Debug",s[s.Info=2]="Info",s[s.Warn=3]="Warn",s[s.Error=4]="Error",s[s.None=5]="None";})(t$1||(t$1={}));const c$1={mode:"pro",website_home:"https://github.com/ohnonoyesyes/zsxq_dl",cache_max_age:47*60*60*1e3,zsxq_base_url:"https://api.zsxq.com/v2",log_level:3,doc_url:"https://github.com/ohnonoyesyes/zsxq_dl",support_url:"https://github.com/ohnonoyesyes/zsxq_dl",key_usage_doc_url:"https://github.com/ohnonoyesyes/zsxq_dl#xRraen",server_host:"https://github.com/ohnonoyesyes/zsxq_dl",free_download_limit:100000,task_count_limit:20};

	const l$1=chrome&&chrome.storage&&!!chrome.storage.sync;function u$1(e){return l$1?new Promise((t,s)=>{chrome.storage.sync.set(e,()=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t();});}):(localStorage.setItem("__storage__",JSON.stringify(e)),Promise.resolve())}function n(e){if(l$1)return new Promise((t,s)=>{chrome.storage.sync.get(e,r=>{chrome.runtime.lastError?s(chrome.runtime.lastError):t(e?r&&r[e]:r);});});{const t=JSON.parse(localStorage.getItem("__storage__"));return Promise.resolve(e?t&&t[e]:t)}}async function m(e){const t=await n(`${e}_download_history`);return t||{}}async function h(e,t){await u$1({[`${e}_download_history`]:t});}function w(e,t){t=Math.floor(t);let s=t<0?"-":"+",r="00"+Math.abs(t);return r=r.substring(r.length-2),new Date(e.getTime()+60*60*1e3*t).toISOString().replace("Z",`${s}${r}:00`)}function g(e){return e.state==="success"?{valid:!0,expire_at:e.expire_at}:e.state==="invalid"?{valid:e.re&&e.re.state==="success",expire_at:e.re?e.re.expire_at:e.expire_at}:{valid:!1,expire_at:e.expire_at}}function v(){const e=`${c$1.server_host}`;window.open(e,"_blank");}async function x(){let e=await n("detail");if(!e)return {validated:!1};if((await n("savedAt")||1)+c$1.cache_max_age>Date.now())return f$1(e);const r=await(await fetch(`${c$1.server_host}/license?key=${e.orderid}`)).json();return r.code===0&&(e=r.data,await u$1({detail:e,savedAt:Date.now()})),f$1(e)}function f$1(e){if(!e)return null;const t=g(e),s=t.valid,r=t.expire_at,a=e.orderid,c=e.urlkey;return {validated:s,expire_at:r,key:a,urlkey:c}}

	let i=t$1.All;function f(o,...n){i<=t$1.Error&&console.error(o,...n);}function c(o,...n){i<=t$1.Warn&&console.warn(o,...n);}function l(o,...n){i<=t$1.Info&&console.info(o,...n);}function r(o,...n){i<=t$1.Debug&&console.debug(o,...n);}function t(o){i=o;}const u={d:r,i:l,w:c,e:f,init:t};

	var ye=Object.defineProperty,ve=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var J=(o,e,n)=>e in o?ye(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n,M=(o,e)=>{for(var n in e||(e={}))ke.call(e,n)&&J(o,n,e[n]);if(re)for(var n of re(e))xe.call(e,n)&&J(o,n,e[n]);return o},X=(o,e)=>ve(o,be(e));var S=(o,e,n)=>(J(o,typeof e!="symbol"?e+"":e,n),n);function Se(o){const e=n=>{o.contains(n.target)||o.dispatchEvent(new CustomEvent("outclick"));};return document.addEventListener("click",e,!0),{destroy(){document.removeEventListener("click",e,!0);}}}function fe(o){let e,n,t,i,l,s,c,u;return {c(){e=pt$1("div"),n=pt$1("button"),n.textContent="\u4E0B\u8F7D\u5168\u90E8\u6587\u4EF6",t=Rt(),i=pt$1("a"),l=X$1("\u4F7F\u7528\u5E2E\u52A9"),Dt(n,"class","hover:bg-gray-200 py-3 px-8 w-full text-gray-800"),Dt(i,"class","hover:bg-gray-200 py-3 px-8 w-full text-gray-800 block text-center"),Dt(i,"href",s=c$1.doc_url),Dt(i,"target","_blank"),Dt(e,"class","overflow-hidden w-48 h-auto opacity-100 absolute bottom-1/3 right-16 shadow bg-white py-4 rounded");},m(w,f){jt(w,e,f),ft$1(e,n),ft$1(e,t),ft$1(e,i),ft$1(i,l),c||(u=Bt(n,"click",o[2]),c=!0);},p:w$1,d(w){w&&ht$1(e),c=!1,u();}}}function ze(o){let e,n,t,i,l,s=o[0]&&fe(o);return {c(){e=pt$1("div"),n=pt$1("div"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-white" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"></path></svg>',t=Rt(),s&&s.c(),Dt(n,"class","zsxq-button rounded-full w-14 h-14 flex justify-center items-center shadow cursor-pointer svelte-12gu28x"),Dt(e,"class","extension fixed bottom-3 z-9  svelte-12gu28x");},m(c,u){jt(c,e,u),ft$1(e,n),ft$1(e,t),s&&s.m(e,null),i||(l=[Bt(n,"click",o[1]),Ot(Se.call(null,e)),Bt(e,"outclick",o[3])],i=!0);},p(c,[u]){c[0]?s?s.p(c,u):(s=fe(c),s.c(),s.m(e,null)):s&&(s.d(1),s=null);},i:w$1,o:w$1,d(c){c&&ht$1(e),s&&s.d(),i=!1,k(l);}}}function Ce(o,e,n){let t=!1;const i=u=>{n(0,t=!t),u.stopPropagation();},l=Wt();return [t,i,()=>{n(0,t=!1),l("download");},()=>n(0,t=!1)]}class je extends Xt{constructor(e){super();Vt(this,e,Ce,ze,rt$1,{});}}const ne=Yt([]);var E;(function(o){o[o.None=0]="None",o[o.PaymentNotice=1]="PaymentNotice",o[o.DownloadList=2]="DownloadList",o[o.ErrorNotice=3]="ErrorNotice";})(E||(E={}));const O=Yt(0);function Ne(o){let e,n,t,i,l;return {c(){e=pt$1("button"),n=X$1(o[2]),Dt(e,"class",t=""+((o[0]?"button-active":"button-inactive")+" w-36 h-12 rounded-full text-white text-base svelte-1ozed48"));},m(s,c){jt(s,e,c),ft$1(e,n),i||(l=Bt(e,"click",function(){T(o[1])&&o[1].apply(this,arguments);}),i=!0);},p(s,[c]){o=s,c&4&&Tt(n,o[2]),c&1&&t!==(t=""+((o[0]?"button-active":"button-inactive")+" w-36 h-12 rounded-full text-white text-base svelte-1ozed48"))&&Dt(e,"class",t);},i:w$1,o:w$1,d(s){s&&ht$1(e),i=!1,l();}}}function Ae(o,e,n){let{active:t}=e,{onclick:i}=e,{label:l}=e;return o.$$set=s=>{"active"in s&&n(0,t=s.active),"onclick"in s&&n(1,i=s.onclick),"label"in s&&n(2,l=s.label);},[t,i,l]}class Z extends Xt{constructor(e){super();Vt(this,e,Ae,Ne,rt$1,{active:0,onclick:1,label:2});}}function qe(o){let e,n,t,i,l,s,c,u,w,f,d,_,m,v,k,y;return d=new Z({props:{active:!1,label:o[2],onclick:o[6]}}),m=new Z({props:{active:!0,label:o[3],onclick:o[7]}}),{c(){e=pt$1("div"),n=pt$1("div"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',t=Rt(),i=pt$1("h1"),l=X$1(o[0]),s=Rt(),c=pt$1("div"),u=X$1(o[1]),w=Rt(),f=pt$1("div"),Ut(d.$$.fragment),_=Rt(),Ut(m.$$.fragment),Dt(n,"class","items-end absolute right-1 top-2 text-gray-500 cursor-pointer p-1"),Dt(i,"class","text-3xl text-gray-800"),Dt(c,"class","text-lg text-gray-700 my-8"),Dt(f,"class","w-full flex justify-between px-4 mt-4"),Dt(e,"class","notice bg-white rounded-md overflow-hidden flex flex-col items-center py-10 px-14 relative svelte-1hw961f");},m(r,a){jt(r,e,a),ft$1(e,n),ft$1(e,t),ft$1(e,i),ft$1(i,l),ft$1(e,s),ft$1(e,c),ft$1(c,u),ft$1(e,w),ft$1(e,f),kt(d,f,null),ft$1(f,_),kt(m,f,null),v=!0,k||(y=Bt(n,"click",o[5]),k=!0);},p(r,[a]){(!v||a&1)&&Tt(l,r[0]),(!v||a&2)&&Tt(u,r[1]);const h={};a&4&&(h.label=r[2]),d.$set(h);const p={};a&8&&(p.label=r[3]),m.$set(p);},i(r){v||(ot$1(d.$$.fragment,r),ot$1(m.$$.fragment,r),v=!0);},o(r){It(d.$$.fragment,r),It(m.$$.fragment,r),v=!1;},d(r){r&&ht$1(e),St(d),St(m),k=!1,y();}}}function Pe(o,e,n){let{title:t}=e,{content:i}=e,{cancelLabel:l}=e,{confirmLabel:s}=e;const c=Wt(),u=()=>c("exit"),w=()=>c("cancel"),f=()=>c("confirm");return o.$$set=d=>{"title"in d&&n(0,t=d.title),"content"in d&&n(1,i=d.content),"cancelLabel"in d&&n(2,l=d.cancelLabel),"confirmLabel"in d&&n(3,s=d.confirmLabel);},[t,i,l,s,c,u,w,f]}class Re extends Xt{constructor(e){super();Vt(this,e,Pe,qe,rt$1,{title:0,content:1,cancelLabel:2,confirmLabel:3});}}function Ge(o){let e,n,t,i,l,s,c,u,w,f,d,_,m,v;return d=new Z({props:{active:!1,label:o[2],onclick:o[5]}}),{c(){e=pt$1("div"),n=pt$1("div"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',t=Rt(),i=pt$1("h1"),l=X$1(o[0]),s=Rt(),c=pt$1("div"),u=X$1(o[1]),w=Rt(),f=pt$1("div"),Ut(d.$$.fragment),Dt(n,"class","items-end absolute right-1 top-2 text-gray-500 cursor-pointer p-1"),Dt(i,"class","text-3xl text-gray-800"),Dt(c,"class","text-lg text-gray-700 my-8"),Dt(f,"class","w-full flex justify-center px-4 mt-4"),Dt(e,"class","notice bg-white rounded-md overflow-hidden flex flex-col items-center py-10 px-14 relative svelte-1hw961f");},m(k,y){jt(k,e,y),ft$1(e,n),ft$1(e,t),ft$1(e,i),ft$1(i,l),ft$1(e,s),ft$1(e,c),ft$1(c,u),ft$1(e,w),ft$1(e,f),kt(d,f,null),_=!0,m||(v=Bt(n,"click",o[4]),m=!0);},p(k,[y]){(!_||y&1)&&Tt(l,k[0]),(!_||y&2)&&Tt(u,k[1]);const r={};y&4&&(r.label=k[2]),d.$set(r);},i(k){_||(ot$1(d.$$.fragment,k),_=!0);},o(k){It(d.$$.fragment,k),_=!1;},d(k){k&&ht$1(e),St(d),m=!1,v();}}}function Fe(o,e,n){let{title:t}=e,{content:i}=e,{closeLabel:l}=e;const s=Wt(),c=()=>s("exit"),u=()=>s("exit");return o.$$set=w=>{"title"in w&&n(0,t=w.title),"content"in w&&n(1,i=w.content),"closeLabel"in w&&n(2,l=w.closeLabel);},[t,i,l,s,c,u]}class Ve extends Xt{constructor(e){super();Vt(this,e,Fe,Ge,rt$1,{title:0,content:1,closeLabel:2});}}function de(o,e,n){const t=o.slice();return t[4]=e[n],t[6]=n,t}function he(o){let e;return {c(){e=pt$1("li"),e.textContent="\u6682\u65E0\u4E0B\u8F7D\u4EFB\u52A1",Dt(e,"class","text-lg text-gray-600");},m(n,t){jt(n,e,t);},d(n){n&&ht$1(e);}}}function we(o,e){let n,t=e[4].name+"",i;return {key:o,first:null,c(){n=pt$1("li"),i=X$1(t),Dt(n,"class","my-2"),this.first=n;},m(l,s){jt(l,n,s),ft$1(n,i);},p(l,s){e=l,s&1&&t!==(t=e[4].name+"")&&Tt(i,t);},d(l){l&&ht$1(n);}}}function We(o){let e,n,t,i,l,s,c,u=[],w=new Map,f,d,_,m,v,k,y=o[0];const r=h=>h[4].file_id;for(let h=0;h<y.length;h+=1){let p=de(o,y,h),$=r(p);w.set($,u[h]=we($,p));}let a=null;return y.length||(a=he()),_=new Z({props:{active:!1,label:"\u9000\u51FA",onclick:o[3]}}),{c(){e=pt$1("div"),n=pt$1("div"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',t=Rt(),i=pt$1("h1"),i.textContent=`${Xe}`,l=Rt(),s=pt$1("div"),c=pt$1("ul");for(let h=0;h<u.length;h+=1)u[h].c();a&&a.c(),f=Rt(),d=pt$1("div"),Ut(_.$$.fragment),Dt(n,"class","items-end absolute right-1 top-2 text-gray-500 cursor-pointer p-1"),Dt(i,"class","text-3xl text-gray-800"),Dt(c,"class","text-base"),Dt(s,"class","text-gray-700 my-8 w-full"),Dt(d,"class","w-full flex justify-center px-4 mt-2"),Dt(e,"class","notice bg-white rounded-md overflow-hidden flex flex-col items-center py-10 px-14 relative svelte-1hw961f");},m(h,p){jt(h,e,p),ft$1(e,n),ft$1(e,t),ft$1(e,i),ft$1(e,l),ft$1(e,s),ft$1(s,c);for(let $=0;$<u.length;$+=1)u[$].m(c,null);a&&a.m(c,null),ft$1(e,f),ft$1(e,d),kt(_,d,null),m=!0,v||(k=Bt(n,"click",o[2]),v=!0);},p(h,[p]){p&1&&(y=h[0],u=Qt(u,p,r,1,h,y,w,c,Kt,we,null,de),y.length?a&&(a.d(1),a=null):a||(a=he(),a.c(),a.m(c,null)));},i(h){m||(ot$1(_.$$.fragment,h),m=!0);},o(h){It(_.$$.fragment,h),m=!1;},d(h){h&&ht$1(e);for(let p=0;p<u.length;p+=1)u[p].d();a&&a.d(),St(_),v=!1,k();}}}let Xe="\u4E0B\u8F7D\u5217\u8868";function Ke(o,e,n){let t;At(o,ne,c=>n(0,t=c));const i=Wt();return [t,i,()=>i("exit"),()=>i("exit")]}class Oe extends Xt{constructor(e){super();Vt(this,e,Ke,We,rt$1,{});}}function pe(o){let e,n,t,i;const l=[Ze,Ye,Qe],s=[];function c(u,w){return u[0]===E.PaymentNotice?0:u[0]===E.DownloadList?1:u[0]===E.ErrorNotice?2:-1}return ~(n=c(o))&&(t=s[n]=l[n](o)),{c(){e=pt$1("div"),t&&t.c(),Dt(e,"class","mask w-full h-full fixed left-0 top-0 flex flex-col justify-center items-center svelte-195tuv8");},m(u,w){jt(u,e,w),~n&&s[n].m(e,null),i=!0;},p(u,w){let f=n;n=c(u),n===f?~n&&s[n].p(u,w):(t&&(Gt(),It(s[f],1,1,()=>{s[f]=null;}),Ht()),~n?(t=s[n],t?t.p(u,w):(t=s[n]=l[n](u),t.c()),ot$1(t,1),t.m(e,null)):t=null);},i(u){i||(ot$1(t),i=!0);},o(u){It(t),i=!1;},d(u){u&&ht$1(e),~n&&s[n].d();}}}function Qe(o){let e,n;return e=new Ve({props:{title:"\u4E0B\u8F7D\u51FA\u9519",content:"\u4E0B\u8F7D\u8BB0\u5F55\u5DF2\u4FDD\u5B58\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",closeLabel:"\u9000\u51FA"}}),e.$on("exit",o[6]),{c(){Ut(e.$$.fragment);},m(t,i){kt(e,t,i),n=!0;},p:w$1,i(t){n||(ot$1(e.$$.fragment,t),n=!0);},o(t){It(e.$$.fragment,t),n=!1;},d(t){St(e,t);}}}function Ye(o){let e,n;return e=new Oe({}),e.$on("exit",o[5]),{c(){Ut(e.$$.fragment);},m(t,i){kt(e,t,i),n=!0;},p:w$1,i(t){n||(ot$1(e.$$.fragment,t),n=!0);},o(t){It(e.$$.fragment,t),n=!1;},d(t){St(e,t);}}}function Ze(o){let e,n;return e=new Re({props:{title:"\u63D0\u793A",content:"\u60a8\u6b63\u5728\u4f7f\u7528\u7684\u7248\u672c\u4e3a\u65e0\u9650\u4e0b\u8f7d\u7248\uff0c\u6279\u91cf\u4e0b\u8f7d\u529f\u80fd\u652f\u6301\u4e0d\u9650\u91cf\u4e0b\u8f7d\u6587\u4ef6\u3002",cancelLabel:"\u4e0b\u8f7d\u5168\u90e8\u6587\u4ef6",confirmLabel:""}}),e.$on("cancel",o[2]),e.$on("confirm",o[3]),e.$on("exit",o[4]),{c(){Ut(e.$$.fragment);},m(t,i){kt(e,t,i),n=!0;},p:w$1,i(t){n||(ot$1(e.$$.fragment,t),n=!0);},o(t){It(e.$$.fragment,t),n=!1;},d(t){St(e,t);}}}function Ue(o){let e,n,t=o[0]!==E.None&&pe(o);return {c(){t&&t.c(),e=qt();},m(i,l){t&&t.m(i,l),jt(i,e,l),n=!0;},p(i,[l]){i[0]!==E.None?t?(t.p(i,l),l&1&&ot$1(t,1)):(t=pe(i),t.c(),ot$1(t,1),t.m(e.parentNode,e)):t&&(Gt(),It(t,1,1,()=>{t=null;}),Ht());},i(i){n||(ot$1(t),n=!0);},o(i){It(t),n=!1;},d(i){t&&t.d(i),i&&ht$1(e);}}}function Je(o,e,n){let t;O.subscribe(f=>{if(n(0,t=f),f!==E.None){let d=17,_=document.documentElement;typeof window.innerWidth=="number"&&(d=window.innerWidth-_.clientWidth),_.style.overflow="hidden",_.style.borderRight=d+"px solid transparent";}else {let d=document.documentElement;d.style.overflow="",d.style.borderRight="";}});const i=Wt();return [t,i,()=>{i("cancel");},()=>i(""),()=>i("exit"),()=>i("exit"),()=>i("exit")]}class et extends Xt{constructor(e){super();Vt(this,e,Je,Ue,rt$1,{});}}async function me(o){return new Promise(e=>{setTimeout(e,o);})}const tt={download:"__zsxq_downloader__download"};function nt(o,e){chrome.runtime.sendMessage(X(M({},o),{type:tt.download}),n=>e&&e(n));}function it(){const o=/^\/dweb2\/index\/group\/(\d+)$/,e=/\/dweb2\/index\/files/,n=window.location.pathname;if(o.test(n))return o.exec(n)[1];if(e.test(n)){const t=document.querySelector(".all-topic-files a.index"),i=t&&t.getAttribute("href");if(o.test(i))return o.exec(i)[1]}return ""}function ot(){var o,e=o=o||function(n,t){var i;if(typeof window!="undefined"&&window.crypto&&(i=window.crypto),typeof self!="undefined"&&self.crypto&&(i=self.crypto),typeof globalThis!="undefined"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window!="undefined"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof global!="undefined"&&global.crypto&&(i=global.crypto),!i)try{console.error("crypto not found");}catch{}var l=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function r(){}return function(a){var h;return r.prototype=a,h=new r,r.prototype=null,h}}(),c={},u=c.lib={},w=u.Base={extend:function(r){var a=s(this);return r&&a.mixIn(r),(!a.hasOwnProperty("init")||this.init===a.init)&&(a.init=function(){a.$super.init.apply(this,arguments);}),a.init.prototype=a,a.$super=this,a},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var a in r)r.hasOwnProperty(a)&&(this[a]=r[a]);r.hasOwnProperty("toString")&&(this.toString=r.toString);},clone:function(){return this.init.prototype.extend(this)}},f=u.WordArray=w.extend({init:function(r,a){r=this.words=r||[],this.sigBytes=a!=null?a:4*r.length;},toString:function(r){return (r||_).stringify(this)},concat:function(r){var a=this.words,h=r.words,p=this.sigBytes,$=r.sigBytes;if(this.clamp(),p%4)for(var H=0;H<$;H++)a[p+H>>>2]|=(h[H>>>2]>>>24-H%4*8&255)<<24-(p+H)%4*8;else for(var A=0;A<$;A+=4)a[p+A>>>2]=h[A>>>2];return this.sigBytes+=$,this},clamp:function(){var r=this.words,a=this.sigBytes;r[a>>>2]&=4294967295<<32-a%4*8,r.length=n.ceil(a/4);},clone:function(){var r=w.clone.call(this);return r.words=this.words.slice(0),r},random:function(r){for(var a=[],h=0;h<r;h+=4)a.push(l());return new f.init(a,r)}}),d=c.enc={},_=d.Hex={stringify:function(r){for(var a=r.words,h=r.sigBytes,p=[],$=0;$<h;$++){var H=a[$>>>2]>>>24-$%4*8&255;p.push((H>>>4).toString(16)),p.push((15&H).toString(16));}return p.join("")},parse:function(r){for(var a=r.length,h=[],p=0;p<a;p+=2)h[p>>>3]|=parseInt(r.substr(p,2),16)<<24-p%8*4;return new f.init(h,a/2)}},m=d.Latin1={stringify:function(r){for(var a=r.words,h=r.sigBytes,p=[],$=0;$<h;$++)p.push(String.fromCharCode(a[$>>>2]>>>24-$%4*8&255));return p.join("")},parse:function(r){for(var a=r.length,h=[],p=0;p<a;p++)h[p>>>2]|=(255&r.charCodeAt(p))<<24-p%4*8;return new f.init(h,a)}},v=d.Utf8={stringify:function(r){try{return decodeURIComponent(escape(m.stringify(r)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(r){return m.parse(unescape(encodeURIComponent(r)))}},k=u.BufferedBlockAlgorithm=w.extend({reset:function(){this._data=new f.init,this._nDataBytes=0;},_append:function(r){typeof r=="string"&&(r=v.parse(r)),this._data.concat(r),this._nDataBytes+=r.sigBytes;},_process:function(r){var a,h=this._data,p=h.words,$=h.sigBytes,H=this.blockSize,A=$/(4*H),Q=(A=r?n.ceil(A):n.max((0|A)-this._minBufferSize,0))*H,oe=n.min(4*Q,$);if(Q){for(var U=0;U<Q;U+=H)this._doProcessBlock(p,U);a=p.splice(0,Q),h.sigBytes-=oe;}return new f.init(a,oe)},clone:function(){var r=w.clone.call(this);return r._data=this._data.clone(),r},_minBufferSize:0}),y=(u.Hasher=k.extend({cfg:w.extend(),init:function(r){this.cfg=this.cfg.extend(r),this.reset();},reset:function(){k.reset.call(this),this._doReset();},update:function(r){return this._append(r),this._process(),this},finalize:function(r){return r&&this._append(r),this._doFinalize()},blockSize:16,_createHelper:function(r){return function(a,h){return new r.init(h).finalize(a)}},_createHmacHelper:function(r){return function(a,h){return new y.HMAC.init(r,h).finalize(a)}}}),c.algo={});return c}(Math);return e}function rt(){var o,e,n,t,i,l,s,c=(s=ot(),n=(e=(o=s).lib).WordArray,i=[],l=o.algo.SHA1=(t=e.Hasher).extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520]);},_doProcessBlock:function(u,w){for(var f=this._hash.words,d=f[0],_=f[1],m=f[2],v=f[3],k=f[4],y=0;y<80;y++){if(y<16)i[y]=0|u[w+y];else {var r=i[y-3]^i[y-8]^i[y-14]^i[y-16];i[y]=r<<1|r>>>31;}var a=(d<<5|d>>>27)+k+i[y];a+=y<20?1518500249+(_&m|~_&v):y<40?1859775393+(_^m^v):y<60?(_&m|_&v|m&v)-1894007588:(_^m^v)-899497514,k=v,v=m,m=_<<30|_>>>2,_=d,d=a;}f[0]=f[0]+d|0,f[1]=f[1]+_|0,f[2]=f[2]+m|0,f[3]=f[3]+v|0,f[4]=f[4]+k|0;},_doFinalize:function(){var u=this._data,w=u.words,f=8*this._nDataBytes,d=8*u.sigBytes;return w[d>>>5]|=128<<24-d%32,w[14+(d+64>>>9<<4)]=Math.floor(f/4294967296),w[15+(d+64>>>9<<4)]=f,u.sigBytes=4*w.length,this._process(),this._hash},clone:function(){var u=t.clone.call(this);return u._hash=this._hash.clone(),u}}),o.SHA1=t._createHelper(l),o.HmacSHA1=t._createHmacHelper(l),s.SHA1);return c}const lt=rt();function st(){for(var o="",e=0;e<32;e++)o+=Math.floor(16*Math.random()).toString(16),(e===8||e===12||e===16||e===20)&&(o+="-");return o}function at(){return Math.floor(Date.now()/1e3)}function ct(o,e,n){const t=`${o} ${e} ${n}`;return lt(t)}function ie(o){const e="2.13.0",n=at(),t=st(),i=ct(o,n,t);return {"X-Request-Id":t,"X-Version":e,"X-Timestamp":n.toString(),"X-Signature":i}}async function ut(o){const e=`${c$1.zsxq_base_url}/groups/${o}`,t=await(await fetch(e,{credentials:"include",headers:ie(e)})).json();if(t.succeeded)return t.resp_data.group;throw new Error("download error")}async function ge(o,e,n){const t=n?`&end_time=${encodeURIComponent(n)}`:"",i=`${c$1.zsxq_base_url}/groups/${o}/files?count=${e}${t}`,s=await(await fetch(i,{credentials:"include",headers:ie(i)})).json();if(s.succeeded)return s.resp_data.files.map(c=>c.file);throw new Error("request error")}async function ft(o){const e=`${c$1.zsxq_base_url}/files/${o}/download_url`,t=await(await fetch(e,{credentials:"include",headers:ie(e)})).json();if(t.succeeded)return t.resp_data.download_url;throw new Error("download error")}class dt{constructor(e,n=!1){S(this,"queue");S(this,"isDownloading",!1);S(this,"interrupted",!1);S(this,"groupId");S(this,"timer",0);S(this,"groupInfo",null);S(this,"downloadHistory",{});S(this,"paied");S(this,"doDownload",async()=>{try{if(clearTimeout(this.timer),this.completeCurrTask(),this.queue.length===0||this.interrupted){this.isDownloading=!1,this.completeAllTask(),await h(this.groupId,M({},this.downloadHistory));return}this.isDownloading=!0;const e=this.queue.shift();(!this.downloadHistory.end_time||new Date(e.create_time)<new Date(this.downloadHistory.end_time))&&(this.downloadHistory.end_time=e.create_time);const n=await ft(e.file_id);nt(X(M({},e),{download_url:n,group_name:this.groupInfo&&this.groupInfo.name}),t=>u.i(t)),this.completeCurrTask(),this.timer=+setTimeout(this.doDownload,50+Math.floor(Math.random()*100));}catch(e){this.onError(e);}});this.queue=[],this.groupId=e,this.paied=n;}addDownloadTask(e){this.queue.push(...e),this.isDownloading||this.doDownload();}completeCurrTask(){ne.set(this.queue.slice(0,8));}completeAllTask(){}onError(e){u.e(e),O.set(E.ErrorNotice);}async downloadAllFiles(){this.groupInfo=await ut(this.groupId),this.paied?(this.downloadHistory=await m(this.groupId),u.i(this.downloadHistory),await this.downloadFilesAfter(this.downloadHistory.begin_time),await this.downloadFilesBefore(this.downloadHistory.end_time)):await this.downloadFilesBefore();}async downloadFilesBefore(e){try{const n=c$1.task_count_limit;let t=0,i={create_time:e};for(;!i||!i.completed;){let l=await ge(this.groupId,n,i==null?void 0:i.create_time);if(l&&l.length>0&&l.length<n&&new Date(l[l.length-1].create_time).getTime()===new Date(e).getTime()){i=X(M({},i),{completed:!0});continue}t+=l.length,this.addDownloadTask(l),i=l[l.length-1],(l.length<n||!this.paied&&t>=c$1.free_download_limit)&&(i=X(M({},i),{completed:!0})),await me(Math.random()*100+100);}}catch(n){this.onError(n);}}async downloadFilesAfter(e){try{const n=e?new Date(e):new Date,t=c$1.task_count_limit;let i={};for(;!i||!i.completed;){let l=await ge(this.groupId,t,i==null?void 0:i.create_time);if(l&&l.length>0){let s=l.findIndex(c=>new Date(c.create_time)<=n);s!==-1&&(l=l.slice(0,s));}this.addDownloadTask(l),l.length<t?i.completed=!0:i=l[l.length-1],await me(Math.random()*100+100);}this.downloadHistory.begin_time=w(new Date,8),await h(this.groupId,M({},this.downloadHistory));}catch(n){this.onError(n);}}cancelDownload(){this.interrupted=!0;}}function _e(o){let e,n,t,i;return e=new je({}),e.$on("download",o[3]),t=new et({}),t.$on("",v),t.$on("cancel",o[1]),t.$on("exit",o[2]),{c(){Ut(e.$$.fragment),n=Rt(),Ut(t.$$.fragment);},m(l,s){kt(e,l,s),jt(l,n,s),kt(t,l,s),i=!0;},p:w$1,i(l){i||(ot$1(e.$$.fragment,l),ot$1(t.$$.fragment,l),i=!0);},o(l){It(e.$$.fragment,l),It(t.$$.fragment,l),i=!1;},d(l){St(e,l),l&&ht$1(n),St(t,l);}}}function ht(o){let e,n,t=o[0]&&_e(o);return {c(){t&&t.c(),e=qt();},m(i,l){t&&t.m(i,l),jt(i,e,l),n=!0;},p(i,[l]){i[0]?t?(t.p(i,l),l&1&&ot$1(t,1)):(t=_e(i),t.c(),ot$1(t,1),t.m(e.parentNode,e)):t&&(Gt(),It(t,1,1,()=>{t=null;}),Ht());},i(i){n||(ot$1(t),n=!0);},o(i){It(t),n=!1;},d(i){t&&t.d(i),i&&ht$1(e);}}}function wt(o,e,n){let t=l(),i=0;function l(){const m=/^\/dweb2\/index\/group\/(\d+)$/,v=/\/dweb2\/index\/files/;return m.test(window.location.pathname)||v.test(window.location.pathname)}const s=()=>{clearTimeout(i),n(0,t=l()),i=+setTimeout(s,1e3);};let c={key:"",urlkey:"",validated:!1,expire_at:0},u;Lt(()=>(s(),()=>{clearTimeout(i);})),Lt(()=>{(async()=>{const v=await x();c=M(M({},c),v);})();});const w=async()=>{O.set(E.DownloadList);const m=it();u=new dt(m,c.validated),await u.downloadAllFiles();};return [t,()=>{w();},()=>{u&&u.cancelDownload(),O.set(E.None);},async()=>{if(ne.set([]),c.validated)w();else {const m=await x();c=M(M({},c),m),c.validated?w():O.set(E.PaymentNotice);}}]}class pt extends Xt{constructor(e){super();Vt(this,e,wt,ht,rt$1,{});}}new pt({target:document.body});u.init(c$1.log_level);

})();
